@model List<Book>
@using Project_Work_Libreria.Database;
@using Project_Work_Libreria.Models.ModelForViews;

@{
    int counter = 0;
    int count = 0;

    
    List<List<Book>> listLibriPerCategoria = new List<List<Book>>();
    BookCategory cat = new();
    List<BookCategory> listDiCat = new(); 
    using(BookShopContext db = new BookShopContext())
    {
        List<BookCategory> listBookCategory = db.Categories.ToList();
        foreach(BookCategory category in listBookCategory)
        {
            ++counter;
            List<Book> listBook = db.Book.Where(b => b.Category.Id == counter).ToList();
            listLibriPerCategoria.Add(listBook);
            cat =  db.Categories.Where(c => c.Id == counter).FirstOrDefault();
            listDiCat.Add(cat);

        }
    }
}

<div class="main">
    <h1 class="text-center mb-0 mt-3 bianco">La tua libreria</h1>
      

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
            
            @foreach(List<Book> books in listLibriPerCategoria)
            {

               
                List<Book> listaBook = books;

                    if(books.Count >0){
               
                <h1>@listDiCat[count].Name</h1>
                }
                
                foreach(Book book in listaBook)
                {   
                    
                    <div class="card col-3 mt-3 g-3 rounded-3 shadow borders">
                        <img src="@book.ImgSource" class="mt-3 mx-1 rounded-3" />
                        <h1 class="text-center mt-2">@book.Title</h1>
                     



                        <div class="text-center mb-3 d-flex justify-content-around">

                            <div class="mt-auto">


                                <a href="@Url.Action("Details", "Book", new {id = book.Id})">
                                    <button type="button" class="btn btn-n btn-sm dettagli">Dettagli</button>
                                </a>
                            </div>

                            <div class="mt-auto">
                                <form asp-controller="PurchaseData" asp-action="Create" asp-route-id="@book.Id" method="get" class="mt-3">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-r btn-sm dettagli">
                                        Acquista
                                    </button>
                                </form>
                            </div>

                            
                                <button class="like-btn">
                                    <i class="fa-regular fa-heart"></i>
                                </button>
                            


                        </div>

                    </div>
                }
                ++count;
            }
        </div>
    </div>
</div>

